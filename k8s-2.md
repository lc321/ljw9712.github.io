é›†ç¾¤éƒ¨ç½²1
======

####æœ¬æ¬¡éƒ¨ç½²çš„ç½‘ç»œä¿¡æ¯ï¼š

```
Cluster IP CIDR: 10.244.0.0/16
Service Cluster IP CIDR: 10.96.0.0/12
Service DNS IP: 10.96.0.10
DNS DN: cluster.local
Kubernetes API VIP: 39.108.74.92ï¼ˆé˜¿é‡Œäº‘å…¬ç½‘ï¼‰
Kubernetes Ingress VIP: 39.108.74.92ï¼ˆé˜¿é‡Œäº‘å…¬ç½‘ï¼‰
```

####èŠ‚ç‚¹ä¿¡æ¯

```
å…¬ç½‘IP	         å†…ç½‘IP              Hostname	CPU	   Memory
39.108.74.92 	 172.18.143.104      master1	 1	       2G
47.94.211.239	 172.17.7.180        node1       1	       2G
```

 - å¦‚æœå•å°masterçš„è¯Kubernetes API VIPå†™masterçš„ipå³å¯
   
 - å•å°masterçš„è¯æ‰€æœ‰å¤åˆ¶åˆ°å…¶ä»–msterçš„æ“ä½œéƒ½å¿½ç•¥å³å¯

 - è¯¥æ•™ç¨‹ä¸º1å°masterï¼Œ1å°nodeï¼ŒHAçš„æ•™ç¨‹ä¸‹æ¬¡å†å†™å•¦ï¼

 - ç”±äºæ˜¯é˜¿é‡Œäº‘çš„äº‘æœåŠ¡å™¨ï¼Œå¹¶ä¸”å†…ç½‘ä¸å†åŒä¸€ä¸ªvpcä¸Šï¼Œä¼šé¢å¤–åšä¸€äº›æ“ä½œå“¦ï¼
ï¼ˆä¸‹é¢ä¼šè¯´å“¦ğŸ˜¯ï¼‰

----------

 - åœ¨**master1**ä¸Šå£°æ˜é›†ç¾¤ä¿¡æ¯

**ä½¿ç”¨ç¯å¢ƒå˜é‡å£°æ˜é›†ç¾¤ä¿¡æ¯**

```
# å£°æ˜é›†ç¾¤æˆå‘˜ä¿¡æ¯
declare -A MasterArray otherMaster NodeArray
MasterArray=(['master1']=39.108.74.92
otherMaster=()
NodeArray=(['node1']=47.94.211.239

export         VIP=39.108.74.92
export INGRESS_VIP=39.108.74.92
[ "${#MasterArray[@]}" -eq 1 ]  && export VIP=${MasterArray[@]} || export API_PORT=8443
export KUBE_APISERVER=https://${VIP}:${API_PORT:-6443}

#å£°æ˜éœ€è¦å®‰è£…çš„çš„k8sç‰ˆæœ¬
export KUBE_VERSION=v1.12.3

# ç½‘å¡å(ifconfigè‡ªè¡ŒæŸ¥çœ‹ç½‘å¡åç§°)
export interface=eth0

export K8S_DIR=/etc/kubernetes
export PKI_DIR=${K8S_DIR}/pki
export ETCD_SSL=/etc/etcd/ssl
export MANIFESTS_DIR=/etc/kubernetes/manifests/
# cni
export CNI_URL="https://github.com/containernetworking/plugins/releases/download"
export CNI_VERSION=v0.7.1
# cfssl
export CFSSL_URL="https://pkg.cfssl.org/R1.2"
# etcd
export ETCD_version=v3.3.9
```

 - é¦–å…ˆåœ¨master1ä¸Šé€šè¿‡gitè·å–éƒ¨ç½²è¦ç”¨åˆ°çš„äºŒè¿›åˆ¶é…ç½®æ–‡ä»¶å’Œyml

```
git clone https://github.com/ljw9712/k8s-file.git ~/k8s-manual-files
cd ~/k8s-manual-files/
```

- ä¸‹è½½k8säºŒè¿›åˆ¶æ–‡ä»¶

**masterèŠ‚ç‚¹ä¸Š**

```
wget https://github.com/kubernetes/kubernetes/releases/download/v1.12.3/kubernetes.tar.gz
tar -zxvf kubernetes.tar.gz
cd kubernetes/cluster/
./get-kube-binaries.sh
cd ~/kubernetes/server/
tar xzf  kubernetes-server-linux-amd64.tar.gz
cd ~/kubernetes/server/kubernetes/server/bin
cp kube-apiserver /usr/local/bin
cp kube-controller-manager /usr/local/bin
cp kube-scheduler /usr/local/bin
cd ~/kubernetes/client
tar xzf kubernetes-client-linux-amd64.tar.gz
cd ~/kubernetes/client/kubernetes/client/bin
cp kubectl /usr/local/bin
### masterä¸æƒ³åšnodeå¯ä»¥ä¸åšè¿™ä¸€æ­¥
cd ~/kubernetes/server/kubernetes/server/bin
cp kubelet /usr/local/bin
cp kube-proxy /usr/local/bin
```

*åœ¨master1ä¸‹è½½Kubernetes CNI äºŒè¿›åˆ¶æ–‡ä»¶*

```
mkdir -p /opt/cni/bin
wget  "${CNI_URL}/${CNI_VERSION}/cni-plugins-amd64-${CNI_VERSION}.tgz" 
tar -zxf cni-plugins-amd64-${CNI_VERSION}.tgz -C /opt/cni/bin
```

*åœ¨k8s-m1éœ€è¦å®‰è£CFSSLå·¥å…·,è¿™å°†ä¼šç”¨ä¾†å»ºç«‹ TLS Certificates*

```
wget "${CFSSL_URL}/cfssl_linux-amd64" -O /usr/local/bin/cfssl
wget "${CFSSL_URL}/cfssljson_linux-amd64" -O /usr/local/bin/cfssljson
chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson
```

**nodeèŠ‚ç‚¹ä¸Š**

```
wget https://github.com/kubernetes/kubernetes/releases/download/v1.12.3/kubernetes.tar.gz
tar -zxvf kubernetes.tar.gz
cd kubernetes/cluster/
./get-kube-binaries.sh
cd ~/kubernetes/server/
tar xzf  kubernetes-server-linux-amd64.tar.gz
cd ~/kubernetes/server/kubernetes/server/bin
cp kubelet /usr/local/bin
cp kube-proxy /usr/local/bin
```
